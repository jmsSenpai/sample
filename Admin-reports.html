<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Reports</title>
    <link rel="stylesheet" href="Styles/Pages/Admin-reports.css">
</head>
<body>
    <div id="nav-bar">
        <input id="nav-toggle" type="checkbox"/>
        <div id="nav-header">
            <div id="nav-logo-container">
              <a id="nav-title" href="https://codepen.io" target="_blank">
                <img src="images/client-logo.png" alt="Lost & Found Logo" id="nav-logo">
                Lost & Found
              </a>
            </div>
            <label for="nav-toggle"><span id="nav-toggle-burger"></span></label>
            <hr/>
          </div>
        <div id="nav-content">
            <a href="Admin-dashboard.html"> 
                <div class="nav-button"><img src="images/dashboard.png" alt=""><span>Dashboard</span></div>
            </a>
            <a href="admin-lost.html"> 
                <div class="nav-button"><img src="images/lost item.png" alt=""><span>Lost Items</span></div>
            </a>
            <a href="admin-Found.html">
                <div class="nav-button"><img src="images/found item.png" alt=""><span>Found Items</span></div>
            </a>
            <a href="admin-match.html"> 
                <div class="nav-button"><img src="images/matched.png" alt=""><span>Matched Items</span></div>
            </a>
            <a href="Admin-Report-Item.html">  
                <div class="nav-button "><img src="images/item report.png" alt=""><span>Report An Item</span></div>
            </a>
            <a href="Admin-reports.html">  
                <div class="nav-button active "><img src="images/report.png" alt=""><span>Reports</span></div>
            </a>
            <a href="admin-accounts.html">  
                <div class="nav-button "><img src="images/admin acc.png" alt=""><span>Accounts</span></div>
            </a>
        
          <hr/>
          <div class="nav-button" id="logout-btn">
            <img src="images/logout.png" alt=""><span>Logout</span>
        </div>
            <div id="nav-content-highlight"></div>
        </div>
        <input id="nav-footer-toggle" type="checkbox"/>
        <div id="nav-footer">
            <div id="nav-footer-heading">
                <div id="nav-footer-avatar"><img src="https://gravatar.com/avatar/4474ca42d303761c2901fa819c4f2547"/></div>
                <div id="nav-footer-titlebox"><a id="nav-footer-title" href="https://codepen.io/uahnbu/pens/public" target="_blank">uahnbu</a><span id="nav-footer-subtitle">Admin</span></div>
                <label for="nav-footer-toggle"><i class="fas fa-caret-up"></i></label>
            </div>
            <div id="nav-footer-content">
                <Lorem>ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</Lorem>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <h1>All Reported Items</h1>
        <h2>Lost, Found, and Matched Items in the System</h2>

        <!-- Filters -->
        <div class="filters">
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate">
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate">
            <label for="statusFilter">Status:</label>
            <select id="statusFilter">
                <option value="All">All</option>
                <option value="Pending">Pending</option>
                <option value="Matched">Matched</option>
                <option value="Claimed">Claimed</option>
            </select>
            <button onclick="applyFilters()">Apply Filters</button>
        </div>

        <div class="reported-sections">
            <div class="reported-section lost">
                <h3>Reported Lost Items</h3>
                <ul id="recentLostItems" class="item-list"></ul>
            </div>

            <div class="reported-section found">
                <h3>Reported Found Items</h3>
                <ul id="recentFoundItems" class="item-list"></ul>
            </div>

            <div class="reported-section matched">
                <h3>Matched Items</h3>
                <ul id="matchedItems" class="item-list"></ul>
            </div>
        </div>
    </div>

    <!-- View Lost Item Modal -->
    <div id="viewLostItemModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('viewLostItemModal')">×</span>
            <h2>View Lost Item</h2>
            <img id="viewLostImage" style="max-width:100%; max-height:200px;"><br>
            <p><strong>Name:</strong> <span id="viewLostName"></span></p>
            <p><strong>Category:</strong> <span id="viewLostCategory"></span></p>
            <p><strong>Last Located:</strong> <span id="viewLostLastLocated"></span></p>
            <p><strong>Date Lost:</strong> <span id="viewLostDateLost"></span></p>
            <p><strong>Color:</strong> <span id="viewLostColor"></span></p>
            <p><strong>Description:</strong> <span id="viewLostDescription"></span></p>
            <p><strong>Reported By:</strong> <span id="viewLostReportedBy"></span></p>
            <p><strong>Status:</strong> <span id="viewLostStatus"></span></p>
        </div>
    </div>

    <!-- View Found Item Modal -->
    <div id="viewFoundItemModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('viewFoundItemModal')">×</span>
            <h2>View Found Item</h2>
            <img id="viewFoundImage" style="max-width:100%; max-height:200px;"><br>
            <p><strong>Name:</strong> <span id="viewFoundName"></span></p>
            <p><strong>Category:</strong> <span id="viewFoundCategory"></span></p>
            <p><strong>Found At:</strong> <span id="viewFoundFoundAt"></span></p>
            <p><strong>Date Found:</strong> <span id="viewFoundDateFound"></span></p>
            <p><strong>Color:</strong> <span id="viewFoundColor"></span></p>
            <p><strong>Description:</strong> <span id="viewFoundDescription"></span></p>
            <p><strong>Reported By:</strong> <span id="viewFoundReportedBy"></span></p>
            <p><strong>Status:</strong> <span id="viewFoundStatus"></span></p>
        </div>
    </div>

    <!-- View Matched Item Modal -->
    <div id="viewMatchModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('viewMatchModal')">×</span>
            <h2>View Matched Item</h2>
            <div class="modal-images">
                <div>
                    <img id="viewMatchLostImage" style="max-width:200px; height:auto;" onclick="previewImage(this.src)">
                    <p>Lost Image</p>
                </div>
                <div>
                    <img id="viewMatchFoundImage" style="max-width:200px; height:auto;" onclick="previewImage(this.src)">
                    <p>Found Image</p>
                </div>
            </div>
            <div class="modal-details">
                <p><strong>Match Score:</strong> <span id="viewMatchScore"></span></p>
                <p><strong>Lost Item:</strong> <span id="viewMatchLostName"></span></p>
                <p><strong>Lost Description:</strong> <span id="viewMatchLostDescription"></span></p>
                <p><strong>Lost Category:</strong> <span id="viewMatchLostCategory"></span></p>
                <p><strong>Lost Color:</strong> <span id="viewMatchLostColor"></span></p>
                <p><strong>Last Seen At:</strong> <span id="viewMatchLostLocation"></span></p>
                <p><strong>Date Lost:</strong> <span id="viewMatchLostDate"></span></p>
                <p><strong>Lost Reported By:</strong> <span id="viewMatchLostReportedBy"></span></p>
                <hr>
                <p><strong>Found Item:</strong> <span id="viewMatchFoundName"></span></p>
                <p><strong>Found Description:</strong> <span id="viewMatchFoundDescription"></span></p>
                <p><strong>Found Category:</strong> <span id="viewMatchFoundCategory"></span></p>
                <p><strong>Found Color:</strong> <span id="viewMatchFoundColor"></span></p>
                <p><strong>Found At:</strong> <span id="viewMatchFoundLocation"></span></p>
                <p><strong>Date Found:</strong> <span id="viewMatchFoundDate"></span></p>
                <p><strong>Found Reported By:</strong> <span id="viewMatchFoundReportedBy"></span></p>
            </div>
        </div>
    </div>

  

    <script>
        // Authentication check
        if (!localStorage.getItem("loggedInAdmin")) {
            alert("Please log in as an admin.");
            window.location.href = "admin-login.html";
        }

        function loadReports(startDate, endDate, status) {
            const lostList = document.getElementById("recentLostItems");
            const foundList = document.getElementById("recentFoundItems");
            const matchedList = document.getElementById("matchedItems");
            lostList.innerHTML = "";
            foundList.innerHTML = "";
            matchedList.innerHTML = "";

            // Load lost items
            let lostItems = JSON.parse(localStorage.getItem("lostItems")) || [];
            let matchedItems = JSON.parse(localStorage.getItem("matchedItems")) || [];
            let foundItems = JSON.parse(localStorage.getItem("foundItems")) || [];

            // Infer status if not present
            lostItems = lostItems.map(item => ({
                ...item,
                status: item.status || (matchedItems.some(m => m.lostID === item.idLost) ? "Matched" : "Pending")
            }));

            // Filter lost items
            let filteredLostItems = lostItems;
            if (startDate && endDate) {
                filteredLostItems = filteredLostItems.filter(item => {
                    const itemDate = new Date(item.dateLost);
                    return itemDate >= startDate && itemDate <= endDate;
                });
            }
            if (status && status !== "All") {
                filteredLostItems = filteredLostItems.filter(item => item.status === status);
            }

            filteredLostItems.forEach(item => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>${item.itemName}</strong> - Last located at: ${item.lastLocated}<br>
                    ${item.description || "No description"}<br>
                    <p>Status: ${item.status}</p>
                    <button onclick="viewLostItem(${item.idLost})">View</button>
                    <button onclick="deleteLostItem(${item.idLost})">Delete</button>
                `;
                lostList.appendChild(li);
            });

            // Load found items
            foundItems = foundItems.map(item => ({
                ...item,
                status: item.status || (matchedItems.some(m => m.foundID === item.idFound) ? "Matched" : "Pending")
            }));

            // Filter found items
            let filteredFoundItems = foundItems;
            if (startDate && endDate) {
                filteredFoundItems = filteredFoundItems.filter(item => {
                    const itemDate = new Date(item.dateFound);
                    return itemDate >= startDate && itemDate <= endDate;
                });
            }
            if (status && status !== "All") {
                filteredFoundItems = filteredFoundItems.filter(item => item.status === status);
            }

            filteredFoundItems.forEach(item => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>${item.itemName}</strong> - ${item.foundAt}<br>
                    ${item.description || "No description"}<br>
                    <p>Status: ${item.status}</p>
                    <button onclick="viewFoundItem(${item.idFound})">View</button>
                    <button onclick="deleteFoundItem(${item.idFound})">Delete</button>
                `;
                foundList.appendChild(li);
            });

            // Load matched items
            let filteredMatchedItems = matchedItems;
            if (startDate && endDate) {
                filteredMatchedItems = filteredMatchedItems.filter(match => {
                    const matchDate = new Date(match.itemLostDate); // Using itemLostDate for filtering
                    return matchDate >= startDate && matchDate <= endDate;
                });
            }

            filteredMatchedItems.forEach(match => {
                const lost = lostItems.find(item => item.idLost === match.lostID);
                const found = foundItems.find(item => item.idFound === match.foundID);
                if (!lost || !found) return; // Skip if items are missing

                const li = document.createElement("li");
                li.classList.add("matched-item");
                li.innerHTML = `
                    <strong>Lost:</strong> ${lost.itemName} - <strong>Found:</strong> ${found.itemName}<br>
                    <p>Match Score: ${match.totalPoints}/100</p>
                    <button onclick="viewMatchedItem(${match.lostID}, ${match.foundID})">View</button>
                    <button onclick="deleteMatchedItem(${match.lostID}, ${match.foundID})">Delete</button>
                `;
                matchedList.appendChild(li);
            });
        }

        function applyFilters() {
            const startDate = document.getElementById("startDate").value ? new Date(document.getElementById("startDate").value) : null;
            const endDate = document.getElementById("endDate").value ? new Date(document.getElementById("endDate").value) : null;
            const status = document.getElementById("statusFilter").value;

            
            if (endDate) {
                endDate.setHours(23, 59, 59, 999);
            }

            loadReports(startDate, endDate, status);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        function viewLostItem(id) {
            const items = JSON.parse(localStorage.getItem("lostItems")) || [];
            const matchedItems = JSON.parse(localStorage.getItem("matchedItems")) || [];
            const item = items.find(i => i.idLost === id);
            if (!item) return alert("Item not found");

            document.getElementById("viewLostName").innerText = item.itemName || "N/A";
            document.getElementById("viewLostCategory").innerText = item.category || "N/A";
            document.getElementById("viewLostLastLocated").innerText = item.lastLocated || "N/A";
            document.getElementById("viewLostDateLost").innerText = item.dateLost || "N/A";
            document.getElementById("viewLostColor").innerText = item.itemColor || "N/A";
            document.getElementById("viewLostDescription").innerText = item.description || "No description";
            document.getElementById("viewLostReportedBy").innerText = item.reportedBy || "N/A";
            document.getElementById("viewLostStatus").innerText = item.status || (matchedItems.some(m => m.lostID === id) ? "Matched" : "Pending");

            const viewImage = document.getElementById("viewLostImage");
            viewImage.src = item.image || "images/default-image.png";

            document.getElementById("viewLostItemModal").style.display = "flex";
        }

        function viewFoundItem(id) {
            const items = JSON.parse(localStorage.getItem("foundItems")) || [];
            const matchedItems = JSON.parse(localStorage.getItem("matchedItems")) || [];
            const item = items.find(i => i.idFound === id);
            if (!item) return alert("Item not found");

            document.getElementById("viewFoundName").innerText = item.itemName || "N/A";
            document.getElementById("viewFoundCategory").innerText = item.category || "N/A";
            document.getElementById("viewFoundFoundAt").innerText = item.foundAt || "N/A";
            document.getElementById("viewFoundDateFound").innerText = item.dateFound || "N/A";
            document.getElementById("viewFoundColor").innerText = item.itemColor || "N/A";
            document.getElementById("viewFoundDescription").innerText = item.description || "No description";
            document.getElementById("viewFoundReportedBy").innerText = item.reportedBy || "N/A";
            document.getElementById("viewFoundStatus").innerText = item.status || (matchedItems.some(m => m.foundID === id) ? "Matched" : "Pending");

            const viewImage = document.getElementById("viewFoundImage");
            viewImage.src = item.image || "images/default-image.png";

            document.getElementById("viewFoundItemModal").style.display = "flex";
        }

        function viewMatchedItem(lostID, foundID) {
            const lostItems = JSON.parse(localStorage.getItem("lostItems")) || [];
            const foundItems = JSON.parse(localStorage.getItem("foundItems")) || [];
            const matchedItems = JSON.parse(localStorage.getItem("matchedItems")) || [];
            const lost = lostItems.find(item => item.idLost === lostID);
            const found = foundItems.find(item => item.idFound === foundID);
            const match = matchedItems.find(m => m.lostID === lostID && m.foundID === foundID);

            if (!lost || !found || !match) {
                alert("Cannot display match details: Item data not found.");
                return;
            }

            document.getElementById("viewMatchScore").innerText = `${match.totalPoints}/100`;
            document.getElementById("viewMatchLostName").innerText = lost.itemName || "N/A";
            document.getElementById("viewMatchLostDescription").innerText = lost.description || "No description";
            document.getElementById("viewMatchLostCategory").innerText = lost.category || "N/A";
            document.getElementById("viewMatchLostColor").innerText = lost.itemColor || "N/A";
            document.getElementById("viewMatchLostLocation").innerText = lost.lastLocated || "N/A";
            document.getElementById("viewMatchLostDate").innerText = lost.dateLost || "N/A";
            document.getElementById("viewMatchLostReportedBy").innerText = lost.reportedBy || "N/A";
            document.getElementById("viewMatchFoundName").innerText = found.itemName || "N/A";
            document.getElementById("viewMatchFoundDescription").innerText = found.description || "No description";
            document.getElementById("viewMatchFoundCategory").innerText = found.category || "N/A";
            document.getElementById("viewMatchFoundColor").innerText = found.itemColor || "N/A";
            document.getElementById("viewMatchFoundLocation").innerText = found.foundAt || "N/A";
            document.getElementById("viewMatchFoundDate").innerText = found.dateFound || "N/A";
            document.getElementById("viewMatchFoundReportedBy").innerText = found.reportedBy || "N/A";

            document.getElementById("viewMatchLostImage").src = lost.image || "images/default-image.png";
            document.getElementById("viewMatchFoundImage").src = found.image || "images/default-image.png";

            document.getElementById("viewMatchModal").style.display = "flex";
        }

        function deleteLostItem(id) {
            let items = JSON.parse(localStorage.getItem("lostItems")) || [];
            items = items.filter(i => i.idLost !== id);
            localStorage.setItem("lostItems", JSON.stringify(items));
            applyFilters();
        }

        function deleteFoundItem(id) {
            let items = JSON.parse(localStorage.getItem("foundItems")) || [];
            items = items.filter(i => i.idFound !== id);
            localStorage.setItem("foundItems", JSON.stringify(items));
            applyFilters();
        }

        function deleteMatchedItem(lostID, foundID) {
            let matchedItems = JSON.parse(localStorage.getItem("matchedItems")) || [];
            matchedItems = matchedItems.filter(match => !(match.lostID === lostID && match.foundID === foundID));
            localStorage.setItem("matchedItems", JSON.stringify(matchedItems));
            applyFilters();
        }

        function previewImage(src) {
            const modal = document.getElementById("imageModal");
            const img = document.getElementById("previewImg");
            img.src = src;
            modal.style.display = "block";
        }

        function closeImageModal() {
            document.getElementById("imageModal").style.display = "none";
        }

        window.onload = () => loadReports();

        document.addEventListener("DOMContentLoaded", function () {
            const logoutButton = document.getElementById("logout-btn");
            if (logoutButton) {
                logoutButton.addEventListener("click", function () {
                    document.body.classList.add("fade-out");
                    setTimeout(function () {
                        localStorage.removeItem("loggedInAdmin");
                        const inputs = document.querySelectorAll("input");
                        inputs.forEach(input => input.value = "");
                        window.location.href = "admin-login.html";
                    }, 1000);
                });
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
    
    const loggedInAdminUsername = localStorage.getItem("loggedInAdmin");


    if (loggedInAdminUsername) {
        const adminData = JSON.parse(localStorage.getItem(loggedInAdminUsername));
        if (adminData && adminData.accountType === 'admin') {
        
            const fullName = `${adminData.firstName} `;
        
            const navFooterTitle = document.getElementById("nav-footer-title");
            if (navFooterTitle) {
                navFooterTitle.textContent = fullName;
            
                navFooterTitle.href = "#"; 
            }
        }
    }

    
    const logoutButton = document.getElementById("logout-btn");

    if (logoutButton) {
        logoutButton.addEventListener("click", function () {
            document.body.classList.add("fade-out");

            setTimeout(function () {
                localStorage.removeItem("loggedInAdmin");

                const inputs = document.querySelectorAll("input");
                inputs.forEach(input => {
                    input.value = "";
                });

                window.location.href = "admin-login.html";
            }, 1000);
        });
    }
});
    </script>
</body>
</html>